var _=Object.create;var C=Object.defineProperty;var h=Object.getOwnPropertyDescriptor;var R=Object.getOwnPropertyNames;var E=Object.getPrototypeOf,N=Object.prototype.hasOwnProperty;var L=(t,o,s,n)=>{if(o&&typeof o=="object"||typeof o=="function")for(let e of R(o))!N.call(t,e)&&e!==s&&C(t,e,{get:()=>o[e],enumerable:!(n=h(o,e))||n.enumerable});return t};var m=(t,o,s)=>(s=t!=null?_(E(t)):{},L(o||!t||!t.__esModule?C(s,"default",{value:t,enumerable:!0}):s,t));var p=require("fs"),f=m(require("unzipper")),G=m(require("csv-parser")),S=/\d/,I=/\+|_/g,d=/-/g,T=["GLOBALEVENTID","SQLDATE","MonthYear","Year","FractionDate","Actor1Code","Actor1Name","Actor1CountryCode","Actor1KnownGroupCode","Actor1EthnicCode","Actor1Religion1Code","Actor1Religion2Code","Actor1Type1Code","Actor1Type2Code","Actor1Type3Code","Actor2Code","Actor2Name","Actor2CountryCode","Actor2KnownGroupCode","Actor2EthnicCode","Actor2Religion1Code","Actor2Religion2Code","Actor2Type1Code","Actor2Type2Code","Actor2Type3Code","IsRootEvent","EventCode","EventBaseCode","EventRootCode","QuadClass","GoldsteinScale","NumMentions","NumSources","NumArticles","AvgTone","Actor1Geo_Type","Actor1Geo_FullName","Actor1Geo_CountryCode","Actor1Geo_ADM1Code","Actor1Geo_Lat","Actor1Geo_Long","Actor1Geo_FeatureID","Actor2Geo_Type","Actor2Geo_FullName","Actor2Geo_CountryCode","Actor2Geo_ADM1Code","Actor2Geo_Lat","Actor2Geo_Long","Actor2Geo_FeatureID","ActionGeo_Type","ActionGeo_FullName","ActionGeo_CountryCode","ActionGeo_ADM1Code","ActionGeo_Lat","ActionGeo_Long","ActionGeo_FeatureID","DATEADDED","SOURCEURL"];async function D(t){let o=[],s=(0,p.createReadStream)(t).pipe(f.default.Parse({forceStream:!0}));for await(let n of s){let e=n.path.toLowerCase();if(n.type==="File"&&e.endsWith(".csv")){let l=await F(n);o.push(...l)}else n.autodrain()}return o}function a(t,o){return t.length>0&&t.toLowerCase().split(",").forEach(s=>{let n=s.trim();o.indexOf(n)===-1&&o.push(n)}),o}function F(t){return new Promise((o,s)=>{let n=[];t.pipe((0,G.default)({separator:"	",headers:T})).on("data",e=>{let c=a(e.Actor1Geo_FullName,[]);c=a(e.Actor2Geo_FullName,c),c=a(e.Actor1Name,c),c=a(e.Actor2Name,c);let l=e.SOURCEURL.toLowerCase().replace(I,"-").split("/"),g=l[2],u="";for(let i of l)i.length>u.length&&i.indexOf("?")===-1&&i.indexOf("-")>-1&&(u=i);if(u=u.replace(".html","").replace(".htm","").replace(d," ").trim(),u===""){let i=[];for(let r of l.slice(3)){if(r.length<=1||r==="*")continue;let A=r.indexOf("?");A>-1&&(r=r.substring(0,A)),A=r.indexOf("."),A>-1&&(r=r.substring(0,A)),r.length!==0&&S.test(r)===!1&&i.indexOf(r)===-1&&i.push(r.replace(d," "))}u=i.join(" ")}let y={isRoot:parseInt(e.IsRootEvent),year:parseInt(e.Year),month:parseInt(e.MonthYear.substring(4)),day:parseInt(e.SQLDATE.substring(6)),quad:parseInt(e.QuadClass),goldstein:parseInt(e.GoldsteinScale),mentions:parseInt(e.NumMentions),sources:parseInt(e.NumSources),articles:parseInt(e.NumArticles),tone:parseFloat(e.AvgTone),domain:g,url:e.SOURCEURL,summary:u,entities:c};n.push(y)}).on("end",()=>o(n)).on("error",e=>s(e))})}async function v(){let o=await D("data/20240512.export.CSV.zip");(0,p.writeFileSync)("output.json",JSON.stringify(o,null,2))}v();
//# sourceMappingURL=index.js.map